"use strict";$(function(){function e(e,t){$(".notification-container").append('<div class="notification is-'+e+'">'+t+"</div>"),setTimeout(function(){$(".notification-container").children(":first").remove()},5e3)}function t(e){e!==p&&($("#menu").children("li").each(function(){$(this).removeClass("active")}),$("#step-"+e).parent().addClass("active"),$("#content").load("src/html/step"+e+".html").hide().fadeIn("slow"),n(e),p=e)}function n(e){switch(e){case 3:o();break;case 5:a()}}function o(){Weaver.Project.list().then(function(e){u(e)})}function c(e){Weaver.useProject(e),m=e,$(".current-project").addClass("active"),$("#current-project").html((e.attributes.name||"Unnamed project")+" ("+e.nodeId+")"),t(p+1)}function a(){var e=Weaver.currentProject(),t=new Weaver.Project(e.id());t.getAllNodes().then(function(e){l(e)})}function i(){var t=$("#node-name").val(),n=$("#node-id").val();""===n&&(n=void 0);var o=new Weaver.Node(n);t&&o.set("name",t),o.save().then(function(){h[o.nodeId]=o,e("success","Node has been created!")})}function r(){var t=$("#node-attr-id").val(),n=$("#node-attr-key").val(),o=$("#node-attr-val").val();""===t&&(t=void 0),Weaver.Node.load(t).then(function(t){console.log(t),t.set(n,o),t.save(),e("success","Attribute added to node!")})}function d(){var t=$("#node-rel-id1").val(),n=$("#node-rel-key").val(),o=$("#node-rel-id2").val();""===t&&(t=void 0),""===o&&(o=void 0),Weaver.Node.load(t).then(function(t){Weaver.Node.load(o).then(function(o){t.relation(n).add(o),t.save(),e("success","Relationship created!")})})}function s(){var t=Weaver.currentProject().nodeId;m=new Weaver.Project(t),m.wipe(),e("success","Database has been wiped!")}function l(e){var t=$("#node-table"),n=[];$.each(e,function(e,t){h[t.id]=t,n.push("<tr><td>"+t.id+"</td></tr>")}),t.html(n.join(""))}function u(e){var t=$("#project-table"),n=[];$.each(e,function(e,t){f[t.nodeId]=t,n.push("<tr><td>"+t.nodeId+"</td><td>"+(t.attributes.name||"Unnamed poject")+'</td><td><button class="button is-primary is-outlined select-project" data-project="'+t.nodeId+'">Select</button></td></tr>')}),t.html(n.join(""))}function v(){var e=$("#query-field").val(),t=new Weaver.Query;t.nativeQuery(e).then(function(e){$("#query-field").val(JSON.stringify(e,null,4))})}var f={},h={},p=1,b=!1,m=null;$("#content").load("src/html/step1.html"),$("#menu li a").click(function(e){var n=$(this).data("step");t(n)}),$("#content").on("click","#btn-next-step",function(e){t(p+1)}),$("#content").on("click","#refresh-projects",function(e){o()}),$("#content").on("click","#refresh-projects",function(e){a()}),$("#content").on("click","#btn-create-project",function(t){var n=$("#project-name").val(),o=new Weaver.Project;o.set("name",n),o.create().then(function(){o.save(),f[o.nodeId]=o,e("success","Project has been created!")})}),$("#content").on("click","#btn-connect",function(e){var n=$("#db-url").val();Weaver.connect(n).then(function(){$("#step-2").removeClass("disabled"),$("#step-3").removeClass("disabled"),t(p+1),b=Weaver._connected}).catch(function(e){console.log(e)})}),$("#content").on("click","#btn-create-node",function(){i()}),$("#content").on("click","#btn-wipe",function(){s()}),$("#content").on("click","#btn-add-attr",function(){r()}),$("#content").on("click","#btn-add-rel",function(){d()}),$("#content").on("click","#btn-run-query",function(){v()}),$("#content").on("click",".select-project",function(e){var t=$(this).data("project"),n=f[t];c(n),$("#step-4").removeClass("disabled"),$("#step-5").removeClass("disabled"),$("#step-6").removeClass("disabled"),$("#step-7").removeClass("disabled"),$("#step-8").removeClass("disabled")})});